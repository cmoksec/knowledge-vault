# Exploiting pre-built PHP gadget chains

**Vulnerability Summary:**

Signed session cookies using PHP deserialization allow RCE when the secret key is leaked via debug endpoint.

**Attack Flow:**

1. **Discover Debug Endpoint:**
    - Find`/cgi-bin/phpinfo.php`
    - PHPInfo page leaks `SECRET_KEY`
2. **Generate Exploit:**
    - Use PHPGGC to create Symfony RCE4 payload:
        
        `rm /home/carlos/morale.txt`
        
    - Base64-encode the serialized object
3. **Create Signed Cookie:**
    - Sign malicious object with leaked secret key using HMAC-SHA1
    - Format: `{"token":"BASE64_PAYLOAD","sig_hmac_sha1":"HASH"}`
4. **Execute Attack:**
    - Replace session cookie with signed malicious payload
    - Deserialization triggers gadget chain, executing command

---

![image.png](Exploiting%20pre-built%20PHP%20gadget%20chains/image.png)

![image.png](Exploiting%20pre-built%20PHP%20gadget%20chains/image%201.png)

![image.png](Exploiting%20pre-built%20PHP%20gadget%20chains/image%202.png)

![image.png](Exploiting%20pre-built%20PHP%20gadget%20chains/image%203.png)

![image.png](Exploiting%20pre-built%20PHP%20gadget%20chains/image%204.png)

![image.png](Exploiting%20pre-built%20PHP%20gadget%20chains/image%205.png)