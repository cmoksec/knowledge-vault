# EXPERT: Exploiting HTTP request smuggling to perform web cache poisoning

Detect bodyconcat HTTP Smuggling:

![Снимок экрана 2025-12-01 в 15.23.42.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_15.23.42.png)

```jsx
POST / HTTP/1.1
Host: 0a15003a0394323e80541c9f00910004.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 130
Transfer-Encoding: chunked

0

POST /post/next?postId=3 HTTP/1.1
Host: anything
Content-Type: application/x-www-form-urlencoded
Content-Length: 10

x=1
```

1st

![Снимок экрана 2025-12-01 в 15.31.16.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_15.31.16.png)

2nd

![Снимок экрана 2025-12-01 в 15.31.29.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_15.31.29.png)

Also with Collaborator:

![Снимок экрана 2025-12-01 в 15.34.10.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_15.34.10.png)

![Снимок экрана 2025-12-01 в 15.34.23.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_15.34.23.png)

The next thing is to spot an Open Redirect vulnerability:

![Снимок экрана 2025-12-01 в 15.41.50.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_15.41.50.png)

When trying to change Host header, we get an error because the frontend is rejecting it:

![Снимок экрана 2025-12-01 в 15.46.04.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_15.46.04.png)

But instead we can combine smuggling with this open redirect vulnerability to bypass frontend check:

![Снимок экрана 2025-12-01 в 15.45.11.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_15.45.11.png)

![Снимок экрана 2025-12-01 в 15.47.13.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_15.47.13.png)

Finally, spot the tracking.js static resource which is being cached (X-Cache header):

![Снимок экрана 2025-12-01 в 15.48.28.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_15.48.28.png)

Now let’s combine everything and make an exploit to poison the cache with the malicious script.

Store a JS script at the exploit server:

![Снимок экрана 2025-12-01 в 15.53.32.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_15.53.32.png)

Now we need to wait until X-Cache for the tracking.js is around 27, so that we can send our poisoning request:

![Снимок экрана 2025-12-01 в 15.56.41.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_15.56.41.png)

The reason for this is: after invalidating a web cache (>30 sec), if we immediately poison the request queue, the next request coming to tracking.js will be appended to a smuggled request, and the response will come from our exploit server, which will be automatically cached and used as a static js file each time someone asks for it. 

And the final result after the described attack is:

![Снимок экрана 2025-12-01 в 16.00.26.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_16.00.26.png)

As seen, it got cached and redirected to malicious server to fetch and use our script:

![Снимок экрана 2025-12-01 в 16.02.12.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_16.02.12.png)

![Снимок экрана 2025-12-01 в 16.04.09.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_16.04.09.png)

![Снимок экрана 2025-12-01 в 16.05.13.png](EXPERT%20Exploiting%20HTTP%20request%20smuggling%20to%20perfor/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-12-01_%D0%B2_16.05.13.png)