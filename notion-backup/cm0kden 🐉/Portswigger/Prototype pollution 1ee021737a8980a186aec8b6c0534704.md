# Prototype pollution

Created: May 9, 2025 11:21 AM

![image.png](Prototype%20pollution/image.png)

1. **Source** — a user-controlled input that can deliver arbitrary code/properties. For example, URL (parameter or fragment)
2. **Sink** — a JS function or DOM element that executes arbitrary code. For example, `eval()` 
3. **Gadget** — a property that is passed to sink and can contain a malicious payload 

![image.png](Prototype%20pollution/image%201.png)

![image.png](Prototype%20pollution/image%202.png)

![image.png](Prototype%20pollution/image%203.png)

![image.png](Prototype%20pollution/image%204.png)

![image.png](Prototype%20pollution/image%205.png)

![image.png](Prototype%20pollution/image%206.png)

![image.png](Prototype%20pollution/image%207.png)

![image.png](Prototype%20pollution/image%208.png)

![image.png](Prototype%20pollution/image%209.png)

![image.png](Prototype%20pollution/image%2010.png)

![image.png](Prototype%20pollution/image%2011.png)

![image.png](Prototype%20pollution/image%2012.png)

![image.png](Prototype%20pollution/image%2013.png)

![image.png](Prototype%20pollution/image%2014.png)

## Finding client-side prototype pollution gadgets manually

Once you've identified a source that lets you add arbitrary properties to the global `Object.prototype`,
 the next step is to find a suitable gadget that you can use to craft an
 exploit. In practice, we recommend using DOM Invader to do this, but 
it's useful to look at the manual process as it may help solidify your 
understanding of the vulnerability.

1. Look through the source code and identify any
properties that are used by the application or any libraries that it
imports.
2. In Burp, enable response interception (**Proxy > Options > Intercept server responses**) and intercept the response containing the JavaScript that you want to test.
3. Add a `debugger` statement at the start of the script, then forward any remaining requests and responses.
4. In Burp's browser, go to the page on which the target script is loaded. The `debugger` statement pauses execution of the script.
5. While the script is still paused, switch to the console and enter the following command, replacing `YOUR-PROPERTY` with one of the properties that you think is a potential gadget: `Object.defineProperty(Object.prototype, 'YOUR-PROPERTY', { get() { console.trace(); return 'polluted'; }
})`
    
    The property is added to the global `Object.prototype`, and the browser will log a stack trace to the console whenever it is accessed.
    
6. Press the button to continue execution of the script and monitor the console. If a stack trace appears, this confirms that
the property was accessed somewhere within the application.
7. Expand the stack trace and use the provided link to
jump to the line of code where the property is being read.
8. Using the browser's debugger controls, step through
each phase of execution to see if the property is passed to a sink, such as `innerHTML` or `eval()`.
9. Repeat this process for any properties that you think are potential gadgets.

[DOM XSS by Prototype Pollution and DOM Invader tool](Prototype%20pollution/DOM%20XSS%20by%20Prototype%20Pollution%20and%20DOM%20Invader%20too%201ee021737a8980108fbdf56543c7752f.md)

[DOM XSS via Prototype Pollution, custom JS context](Prototype%20pollution/DOM%20XSS%20via%20Prototype%20Pollution,%20custom%20JS%20context%201ee021737a89807d9d7cda4a281516e8.md)

![image.png](Prototype%20pollution/image%2015.png)

Bypassing non-recursive filtering

```bash
?__pro__proto__to__[transport_url]=data%3A%2Calert(1)
```

### CSRF + Prototype Pollution + XSS

```bash
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0a9300d304cf1bbf808e033800dd0055.web-security-academy.net/#constructor[prototype][hitCallback]=alert%28document.cookie%29">
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

![image.png](Prototype%20pollution/image%2016.png)

![image.png](Prototype%20pollution/image%2017.png)

![image.png](Prototype%20pollution/image%2018.png)

![image.png](Prototype%20pollution/image%2019.png)

![image.png](Prototype%20pollution/image%2020.png)

![image.png](Prototype%20pollution/image%2021.png)

![image.png](Prototype%20pollution/image%2022.png)

To test for prototype pollution on server-side environments, non-destructive methods like status / json spaces / charset pollution could be used.

![image.png](Prototype%20pollution/image%2023.png)

![image.png](Prototype%20pollution/image%2024.png)

![image.png](Prototype%20pollution/image%2025.png)

![image.png](Prototype%20pollution/image%2026.png)

![image.png](Prototype%20pollution/image%2027.png)

[EXPERT: **Exfiltrating sensitive data via server-side prototype pollution**](Prototype%20pollution/EXPERT%20Exfiltrating%20sensitive%20data%20via%20server-side%202be021737a8980169ffff8bfa5c81162.md)