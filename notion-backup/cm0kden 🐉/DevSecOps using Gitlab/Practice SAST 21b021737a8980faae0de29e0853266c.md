# Practice: SAST

Created: June 23, 2025 8:26 PM

Initial `.gitlab-ci.yml`:

```yaml
stages:
    - echoprint

printtext-job:
    stage: echoprint
    script:
      - echo "Hey DevSecOps!"
```

### Connect SonarQube

`.gitlab-ci.yml`

```yaml
stages:
    - runSAST

variables:
  SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
  GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task

sonarcloud-check:
  stage: runSAST
  image: maven:3-openjdk-17
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script: |
    mvn verify sonar:sonar -Dsonar.projectKey=${SONAR_PROJECTKEY}
  only:
    - merge_requests
    - master
    - develop
```

`pom.xml` (from SonarQube cmokgroup→vulnado→Administration / Analysis Method→Analyze a project with GitLab CI/CD Pipeline)

![image.png](Practice%20SAST/image.png)

GitLab CI/CD settings

![image.png](Practice%20SAST/image%201.png)

### Configure Quality Gate

```yaml
stages:
    - runSAST

variables:
  SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
  GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task

sonarcloud-check:
  stage: runSAST
  image: maven:eclipse-temurin
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  before_script:
    - apt-get update -qq && apt-get install -y -qq curl jq
  script: |
    mvn verify sonar:sonar -Dsonar.projectKey=${SONAR_PROJECTKEY}
    sleep 2
    echo "Starting Quality Gate Check"
    raw_response=$(curl -s -u "${SONAR_TOKEN}:" "${SONAR_HOST_URL}/api/qualitygates/project_status?projectKey=${SONAR_PROJECTKEY}")
    echo "Raw SonarCloud Project Status API response:"
    echo "$raw_response" | jq .
    quality_status=$(echo "$raw_response" | jq -r '.projectStatus.status')
    echo "Quality Gate Status: $quality_status"
    if [[ $quality_status == "ERROR" ]] ; then exit 1;fi

  only:
    - merge_requests
    - master
    - develop

```

### Sonar Test Coverage

Prerequisites for SonarCloud to register test coverage:

![image.png](Practice%20SAST/image%202.png)

1)

![image.png](Practice%20SAST/image%203.png)

2)

```xml
<!--#Change 1 for SAST - Changes for Unit Test Coverage Percentage Update on SonarCloud Dashboard
#By ASecurityGuru
#Default Location of CodeCoverage File is target/site/jacoco/jacoco.xml,target/site/jacoco-it/jacoco.xml,build/reports/jacoco/test/jacocoTestReport.xml
-->
        <dependency>
						<groupId>junit</groupId>
						<artifactId>junit</artifactId>
						<version>4.12</version>
						<scope>test</scope>
				</dependency>
```

3, 4)

```xml
<!--#Change 2 for SAST - Added Jacoco Plugin - Changes for Unit Test Coverage Percentage Update on SonarCloud Dashboard
#By ASecurityGuru
#Default Location of CodeCoverage File is target/site/jacoco/jacoco.xml,target/site/jacoco-it/jacoco.xml,build/reports/jacoco/test/jacocoTestReport.xml
-->		<plugin>
			<groupId>org.jacoco</groupId>
			<artifactId>jacoco-maven-plugin</artifactId>
			<version>0.8.7</version>
			<executions>
			<execution>
				<id>prepare-agent</id>
				<goals>
				<goal>prepare-agent</goal>
				</goals>
			</execution>
			<execution>
				<id>report</id>
				<goals>
				<goal>report</goal>
				</goals>
				<configuration>
				<formats>
					<format>XML</format>
				</formats>
				</configuration>
			</execution>
			</executions>
		</plugin>
```